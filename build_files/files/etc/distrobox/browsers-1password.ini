# Distrobox configuration for browsers and 1Password
# This container provides Google Chrome, Firefox, and 1Password
# in a Fedora environment with full desktop integration.
#
# Usage:
#   distrobox assemble create --file /etc/distrobox/browsers-1password.ini
#
# The container will:
# - Install Google Chrome, Firefox, and 1Password (GUI + CLI)
# - Export all applications and the op CLI to the host
# - Enable automatic browser integration for 1Password

[browsers-1password]
# Use the official Universal Blue Fedora toolbox image
image=ghcr.io/ublue-os/fedora-toolbox:latest

# Additional packages to install
# Google Chrome repository and package
# Firefox (native Fedora package for better integration)
# 1Password GUI and CLI from official repository
additional_packages="google-chrome-stable firefox 1password 1password-cli"

# Pull the image on each assemble to ensure updates
pull=true

# Not a rootful container
root=false

# Not an init container (systemd not needed)
init=false

# Don't enable NVIDIA drivers (not needed for browsers)
nvidia=false

# Replace existing container if it exists
replace=true

# Start the container immediately after creation
start_now=true

# Pre-initialization hooks - set up repositories before package installation
# Add Google Chrome repository
pre_init_hooks=sudo tee /etc/yum.repos.d/google-chrome.repo > /dev/null <<EOF
[google-chrome]
name=google-chrome
baseurl=https://dl.google.com/linux/chrome/rpm/stable/x86_64
enabled=1
gpgcheck=1
gpgkey=https://dl.google.com/linux/linux_signing_key.pub
EOF

# Add 1Password repository
pre_init_hooks=sudo rpm --import https://downloads.1password.com/linux/keys/1password.asc
pre_init_hooks=sudo tee /etc/yum.repos.d/1password.repo > /dev/null <<EOF
[1password]
name=1Password Stable Channel
baseurl=https://downloads.1password.com/linux/rpm/stable/\$basearch
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://downloads.1password.com/linux/keys/1password.asc
EOF

# Post-initialization hooks - export applications and binaries after installation
# Export Google Chrome
init_hooks=distrobox-export --app google-chrome

# Export Firefox
init_hooks=distrobox-export --app firefox

# Export 1Password GUI
init_hooks=distrobox-export --app 1password

# Export 1Password CLI (op command)
init_hooks=distrobox-export --bin /usr/bin/op --export-path ~/.local/bin

# Export desktop file paths for the host to find them
exported_apps="google-chrome firefox 1password"

# Export the op CLI binary
exported_bins="/usr/bin/op"

# Path where to export binaries (standard user bin location)
exported_bins_path="~/.local/bin"

# Additional notes:
# - Browser integration for 1Password should work automatically
# - The container shares the home directory, so browser profiles persist
# - All exported apps will appear in the host's application menu
# - The 'op' command will be available from the host terminal
